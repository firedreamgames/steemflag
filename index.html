<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>SteemFlag</title>
  
  <style type="text/css" id="gwd-lightbox-style">
    .gwd-lightbox {
      overflow: hidden;
    }
  </style>
  <style type="text/css" id="gwd-text-style">
    p {
      margin: 0px;
    }
    h1 {
      margin: 0px;
    }
    h2 {
      margin: 0px;
    }
    h3 {
      margin: 0px;
    }
  </style>
  <style type="text/css">
    html, body {
      width: 100%;
      height: 100%;
      margin: 0px;
    }
    .gwd-page-container {
      position: relative;
      width: 100%;
      height: 100%;
    }
    .gwd-page-content {
      background-color: transparent;
      transform: perspective(1400px) matrix3d(1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1);
      transform-style: preserve-3d;
      position: absolute;
    }
    .gwd-page-wrapper {
      background-color: rgb(255, 255, 255);
      position: absolute;
      transform: translateZ(0px);
    }
    .page1-content {
      width: 550px;
      height: 400px;
    }
    .gwd-div-1f24 {
      height: 800px;
      width: 1600px;
    }
    .gwd-div-4iup {
      height: 800px;
      width: 1600px;
    }
    .gwd-div-19wr {
      position: absolute;
      width: 703.448px;
      height: 70.1149px;
      left: 484.828px;
      top: 0px;
    }
    .gwd-p-1cre {
      position: absolute;
      width: 629.885px;
      height: 59.8736px;
      text-align: center;
      left: 528px;
      top: 10px;
    }
    .gwd-div-o34r {
      position: absolute;
      width: 192.591px;
      height: 42.8736px;
      left: 65.8px;
      top: 10px;
    }
    .gwd-p-1py6 {
      position: absolute;
      width: 192.586px;
      height: 42.8736px;
      left: 65px;
      top: 10px;
      text-align: right;
    }
    .gwd-p-9q89 {
      left: 266px;
      font-size: 19px;
      text-align: left;
      height: 30px;
    }
    .gwd-p-ua35 {
      font-size: 19px;
      top: 18px;
      left: 66px;
    }
    .gwd-p-1vw5 {
      position: absolute;
      width: 160.92px;
      height: 25.2874px;
      left: 20px;
      top: 91px;
      text-align: center;
      font-size: 15px;
    }
    .gwd-span-1qng {
      font-size: 15px;
    }
    .gwd-p-1blb {
      left: 758px;
      top: 90px;
    }
    .gwd-p-1yv5 {
      left: 928px;
    }
    .gwd-p-pdfc {
      left: 1100px;
      top: 89px;
    }
    .gwd-p-1prq {
      top: 90px;
      left: 700px;
    }
    .gwd-p-r1m6 {
      top: 90px;
      left: 220px;
    }
    .gwd-p-1lw6 {
      top: 90px;
      left: 420px;
    }
    .gwd-p-4uoh {
      top: 90px;
    }
    .gwd-p-1dus {
      position: absolute;
      width: 143.678px;
      height: 45.977px;
      font-size: 19px;
      text-align: center;
      left: 962px;
      top: 15px;
    }
    .gwd-h3-1rsx {
      left: 1110px;
      text-align: left;
    }
    .gwd-div-1oq8 {
      position: absolute;
      left: 15px;
      top: 120px;
      height: 500px;
      width: 900px;
      background-image: none;
      background-color: rgb(241, 236, 236);
      overflow: scroll;
    }
    .gwd-div-t66z {
      position: absolute;
      width: 160.862px;
      left: 20px;
      top: 125px;
      height: 480px;
    }
    .gwd-div-176r {
      left: 190px;
    }
    .gwd-div-nh41 {
      left: 360px;
      top: 125px;
    }
    .gwd-div-1njd {
      left: 530px;
      top: 125px;
    }
    .gwd-div-vubi {
      top: 5px;
      left: 620px;
    }
    .gwd-p-6chl {
      left: 967px;
      top: 91px;
    }
    .gwd-p-h78w {
      left: 1132px;
    }
    .gwd-p-1xay {
      left: 968px;
      top: 124px;
    }
    .gwd-p-1nk3 {
      left: 970px;
      top: 157px;
    }
    .gwd-p-1nfh {
      top: 192px;
      left: 960px;
      text-align: left;
    }
    .gwd-p-106v {
      left: 1135px;
      top: 123px;
    }
    .gwd-p-rqiu {
      left: 1136px;
      top: 155px;
    }
    .gwd-p-wfcu {
      top: 192px;
      text-align: left;
      left: 1130px;
    }
    .gwd-p-zd2y {
      left: 960px;
      text-align: left;
    }
    .gwd-p-14wq {
      left: 960px;
      text-align: left;
    }
    .gwd-p-ddui {
      left: 960px;
      text-align: left;
    }
    .gwd-p-1gzl {
      text-align: left;
      left: 1130px;
    }
    .gwd-p-5vnq {
      text-align: left;
      left: 1130px;
    }
    .gwd-p-127v {
      text-align: left;
      left: 1130px;
    }
    .gwd-input-1cvn {
      top: 0px;
      left: 0px;
    }
    .gwd-div-9aej {
      position: absolute;
      width: 199px;
      height: 44px;
      left: 266px;
      top: 52px;
    }
    .gwd-input-1ce7 {
      width: 150px;
      font-family: "Times New Roman";
      font-size: 16px;
      left: -2px;
      height: 35px;
      top: 0px;
    }
    .gwd-div-ork4 {
      left: 528px;
      top: 10px;
    }
    .gwd-div-13hd {
      left: 266px;
      top: 52px;
    }
    .gwd-div-1sdo {
      left: 20px;
      top: 5px;
      overflow: visible;
    }
    .gwd-div-1s47 {
      top: 5px;
      overflow: visible;
      left: 220px;
    }
    .gwd-div-jhrg {
      top: 5px;
      left: 420px;
    }
    .gwd-div-1ivr {
      position: absolute;
      width: 155.172px;
      height: 35.1724px;
      left: 1410px;
      top: 0px;
    }
    .gwd-div-mrac {
      top: 47px;
    }
    .gwd-p-8p2g {
      left: 620px;
    }
    .gwd-div-12av {
      left: 959px;
      top: 226px;
    }
  </style>
  
  <script src="https://cdn.steemjs.com/lib/latest/steem.min.js"></script>
</head>

<body class="document-body">
  <div is="gwd-pagedeck" class="gwd-page-container" id="pagedeck">
    <div is="gwd-page" id="page1" class="gwd-page-wrapper page1-content gwd-lightbox gwd-div-4iup" data-gwd-width="1600px" data-gwd-height="800px">
      <div class="gwd-page-content page1-content gwd-div-1f24">
        <div class="gwd-div-19wr" id="div_header"></div>
        <h1 class="gwd-p-1cre">FLAG POWER</h1>
        <div class="gwd-div-o34r" id="div_flager"></div>
        <p class="gwd-p-1py6 gwd-p-ua35" id="tag_flagger">Flagger &nbsp;@</p>
        <input class="gwd-p-1py6 gwd-p-9q89" id="input_flagger">
        <p class="gwd-p-1vw5 gwd-p-4uoh">Flagged Person Name</p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-r1m6">Downvoted %</p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1lw6">Flagged Person SP</p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-8p2g">Flagged Person Status</p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-6chl gwd-p-zd2y">Total % Downvoted</p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-6chl gwd-p-1xay gwd-p-14wq">Minnows downvoted</p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-6chl gwd-p-1xay gwd-p-1nk3 gwd-p-ddui">Dolphins downvoted</p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-6chl gwd-p-1xay gwd-p-1nk3 gwd-p-1nfh">Whales downvoted</p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-6chl gwd-p-h78w gwd-p-1gzl" id="Flag_SBD"></p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-6chl gwd-p-h78w gwd-p-106v gwd-p-5vnq" id="Flag_SBD_min"></p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-6chl gwd-p-h78w gwd-p-106v gwd-p-rqiu gwd-p-127v" id="Flag_SBD_dol"></p>
        <p class="gwd-p-1vw5 gwd-p-1blb gwd-p-1yv5 gwd-p-pdfc gwd-p-1prq gwd-p-6chl gwd-p-h78w gwd-p-106v gwd-p-rqiu gwd-p-wfcu" id="Flag_SBD_whale"></p>
        <h3 class="gwd-p-1dus" id="txt_fp"></h3>
        <h3 class="gwd-p-1dus gwd-h3-1rsx" id="txt_SP">SP</h3>
        <div class="gwd-div-1oq8" id="main_board">
          <div class="gwd-div-t66z gwd-div-1sdo" id="vic_name"></div>
          <div class="gwd-div-t66z gwd-div-176r gwd-div-nh41 gwd-div-1s47" id="vic_SBD"></div>
          <div class="gwd-div-t66z gwd-div-176r gwd-div-nh41 gwd-div-1njd gwd-div-jhrg" id="vic_SP"></div>
          <div class="gwd-div-t66z gwd-div-176r gwd-div-nh41 gwd-div-1njd gwd-div-vubi" id="vic_STAT"></div>
        </div>
        <div class="gwd-div-9aej gwd-div-ork4" id="button_div_1">
          <input id="Start_1" type="button" value=" Get_Stats " class="gwd-input-1ce7" onclick="calculate()">
        </div>
        <div class="gwd-div-9aej gwd-div-ork4 gwd-div-12av" id="button_div_2">
          <input id="Start_2" type="button" value=" Calculate " class="gwd-input-1ce7" onclick="total()">
        </div>
        <input id="Start_1" type="button" value=" Search Data " class="gwd-input-1ce7" onclick="search()">
        <div class="gwd-div-1ivr" id="vesting_shares"></div>
        <div class="gwd-div-1ivr gwd-div-mrac" id="vesting_fund"></div>
      </div>
    </div>
  </div>
  
<script>
    steem.api.setOptions({
      url: 'https://api.steemit.com'
    });




    function search()

     {
       document.getElementById("vic_name").innerHTML ="";
       document.getElementById("vic_SBD").innerHTML = "";
       document.getElementById("txt_fp").innerHTML = "";
       document.getElementById("vic_SP").innerHTML = "";
       document.getElementById("vic_STAT").innerHTML ="";
       document.getElementById("Flag_SBD").innerHTML = "";
      document.getElementById("Flag_SBD_min").innerHTML = "";
      document.getElementById("Flag_SBD_dol").innerHTML = "";
      document.getElementById("Flag_SBD_whale").innerHTML = "";
       
      var vesting_shares, delegated_vesting_shares, received_vesting_shares, total_vesting_shares, total_vesting_fund_steem = null;
      var total_downvote = 0;
      steem.api.getDynamicGlobalProperties(function(err, result) {

        document.getElementById("vesting_shares").innerHTML = result.total_vesting_shares;
        document.getElementById("vesting_fund").innerHTML = result.total_vesting_fund_steem;

      });
var flagger=document.getElementById("input_flagger").value
      steem.api.getAccounts([flagger], function(err, response) {
        console.log(response);
        vesting_shares = response[0].vesting_shares.split(' ')[0];
        delegated_vesting_shares = response[0].delegated_vesting_shares.split(' ')[0];
        received_vesting_shares = response[0].received_vesting_shares.split(' ')[0];
        total_vesting_shares = document.getElementById("vesting_shares").innerHTML;
        total_vesting_fund_steem = document.getElementById("vesting_fund").innerHTML;

        console.log(vesting_shares, delegated_vesting_shares, received_vesting_shares);
        var steem_power = steem.formatter.vestToSteem(vesting_shares, total_vesting_shares, total_vesting_fund_steem);
        var delegated_steem_power = steem.formatter.vestToSteem(received_vesting_shares - delegated_vesting_shares + ' VESTS', total_vesting_shares, total_vesting_fund_steem);

        document.getElementById("txt_fp").innerHTML = (steem_power + delegated_steem_power).toFixed(2);

      });

var flagger=document.getElementById("input_flagger").value
      steem.api.getAccountHistory(flagger, -1, 10000, function(err, result) {
        console.log(result.length);
        for (let i = 0; i < result.length; i++) {

          if ((result[i][1].op[0] == 'vote') && (result[i][1].op[1].voter = flagger) && (result[i][1].op[1].weight < 0) && (result[i][1].op[1].author != flagger)) {




            document.getElementById("vic_name").innerHTML = document.getElementById("vic_name").innerHTML + result[i][1].op[1].author + "<br />";

            document.getElementById("vic_SBD").innerHTML = document.getElementById("vic_SBD").innerHTML + (result[i][1].op[1].weight / 100) + " %" + "<br />";


          }
        }


      });



    }

    function calculate()

     {

      var vesting_shares, delegated_vesting_shares, received_vesting_shares, total_vesting_shares, total_vesting_fund_steem = null;
      var names = document.getElementById("vic_name").innerHTML.split('<br>');
      var sbd = document.getElementById("vic_SBD").innerHTML.split('<br>');
      document.getElementById("vic_name").innerHTML = "";
      document.getElementById("vic_SBD").innerHTML = "";
      total_vesting_shares = document.getElementById("vesting_shares").innerHTML;
      total_vesting_fund_steem = document.getElementById("vesting_fund").innerHTML;
      for (let i = 0; i < names.length; i++) {

        steem.api.getAccounts([names[i]], function(err, response) {
          console.log(response);
          vesting_shares = response[0].vesting_shares.split(' ')[0];
          delegated_vesting_shares = response[0].delegated_vesting_shares.split(' ')[0];
          received_vesting_shares = response[0].received_vesting_shares.split(' ')[0];


          var steem_power = steem.formatter.vestToSteem(vesting_shares, total_vesting_shares, total_vesting_fund_steem);
          var delegated_steem_power = steem.formatter.vestToSteem(received_vesting_shares - delegated_vesting_shares + ' VESTS', total_vesting_shares, total_vesting_fund_steem);
          document.getElementById("vic_name").innerHTML = document.getElementById("vic_name").innerHTML + names[i] + "<br />";
          document.getElementById("vic_SBD").innerHTML = document.getElementById("vic_SBD").innerHTML + sbd[i] + "<br />";

          document.getElementById("vic_SP").innerHTML = document.getElementById("vic_SP").innerHTML + (steem_power + delegated_steem_power).toFixed(2) + "<br />";

          if ((steem_power + delegated_steem_power) < 20000) {
            document.getElementById("vic_STAT").innerHTML = document.getElementById("vic_STAT").innerHTML + "minnow" + "<br />";


          }
          if (((steem_power + delegated_steem_power) < 200000) && ((steem_power + delegated_steem_power) >= 20000)) {
            document.getElementById("vic_STAT").innerHTML = document.getElementById("vic_STAT").innerHTML + "dolphin" + "<br />";

          }

          if ((steem_power + delegated_steem_power) >= 200000) {
            document.getElementById("vic_STAT").innerHTML = document.getElementById("vic_STAT").innerHTML + "whale" + "<br />";

          }



        });




      }
    }

    function total() {
      var min_flag = 0;
      var dol_flag = 0;
      var wha_flag = 0;
      var SBD = document.getElementById("vic_SBD").innerHTML.split('<br>');
      var STAT = document.getElementById("vic_STAT").innerHTML.split('<br>');

      for (let i = 0; i < SBD.length; i++) {
        if (STAT[i] == "minnow") {
          min_flag = min_flag + parseInt(SBD[i].split(" ")[0]);

        }
        if (STAT[i] == "dolphin") {
          dol_flag = dol_flag + parseInt(SBD[i].split(" ")[0]);

        }

        if (STAT[i] == "whale") {
          wha_flag = wha_flag + parseInt(SBD[i].split(" ")[0]);

        }



      }

      document.getElementById("Flag_SBD").innerHTML = (min_flag + dol_flag + wha_flag) + " %";
      document.getElementById("Flag_SBD_min").innerHTML = (min_flag) + " %";
      document.getElementById("Flag_SBD_dol").innerHTML = (dol_flag) + " %";
      document.getElementById("Flag_SBD_whale").innerHTML = (wha_flag) + " %";


    }
  </script>
</body>

</html>